---
- name: Create {{galaxy_export_dir}}/galaxy-central dir
  file:
    path: "{{galaxy_export_dir}}/galaxy-central"
    state: directory
    owner: "{{galaxy_user}}"

- name: Create {{galaxy_export_dir}}/galaxy/database/job_working_directory dir
  file:
    path: "{{galaxy_export_dir}}/galaxy/database/job_working_directory"
    state: directory
    recurse: yes
    owner: "{{galaxy_user}}"

- name: force all notified handlers (to assure docker is restarted)
  meta: flush_handlers

- include_tasks: slurm.yml
  when: galaxy_lrms == "slurm"

- name: Start galaxy container
  docker_container:
    name: galaxy
    image: "quay.io/bgruening/galaxy:{{galaxy_image_version}}"
    ports:
     - "8443:443"
     - "8080:80"
     - "8022:22"
     - "8021:21"
     - "9002:9002"
#     - "8800:8800"
    env: "{{galaxy_docker_env_vars}}"
    volumes: "{{galaxy_docker_volumes}}"
    privileged: yes 
